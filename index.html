<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSIKR - Enterprise ESG Platform (v201.0 Fixed)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; }
        .nav-item { transition: all 0.2s; border-radius: 12px; font-weight: 600; color: #64748b; font-size: 14px; cursor: pointer; }
        .nav-item:hover { background-color: #f1f5f9; color: #334155; }
        .nav-active { background-color: #4f46e5; color: white; box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2); }
        .nav-active:hover { background-color: #4338ca; color: white; }
        .kpi-card { background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 20px; }
        .input-field { width: 100%; border: 1px solid #cbd5e1; border-radius: 8px; padding: 8px 12px; font-size: 13px; text-align: right; transition: all 0.2s; }
        .input-field:focus { border-color: #6366f1; outline: none; ring: 2px solid #e0e7ff; }
        .report-paper { width: 210mm; min-height: 297mm; padding: 20mm; margin: 0 auto; background: white; border: 1px solid #e2e8f0; }
        .modal-overlay { background-color: rgba(15, 23, 42, 0.8); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <div class="h-14 bg-slate-900 text-white flex items-center px-6 justify-between shrink-0 z-50 shadow-lg">
        <div class="flex items-center gap-4">
            <span class="text-lg font-bold tracking-tight">KSIKR <span class="text-indigo-400">Pro</span></span>
            <span class="bg-indigo-600 px-2 py-0.5 rounded text-[10px] font-bold">v201.0 Fixed</span>
        </div>
        <div class="text-xs text-slate-400">ISO 14067 & GHG Protocol Compliant</div>
    </div>

    <div class="flex flex-1 overflow-hidden h-full">
        <aside class="w-64 bg-white border-r border-slate-200 flex flex-col z-40">
            <nav class="flex-1 p-4 space-y-2">
                <div onclick="switchTab('dashboard')" id="btn-dashboard" class="nav-item px-4 py-3 flex items-center gap-3 nav-active"><i class="fas fa-chart-line w-5"></i> 대시보드</div>
                <div onclick="switchTab('lca')" id="btn-lca" class="nav-item px-4 py-3 flex items-center gap-3"><i class="fas fa-calculator w-5"></i> LCA 평가</div>
                <div onclick="switchTab('report')" id="btn-report" class="nav-item px-4 py-3 flex items-center gap-3"><i class="fas fa-file-contract w-5"></i> 인증 리포트</div>
                <div onclick="switchTab('corporate')" id="btn-corporate" class="nav-item px-4 py-3 flex items-center gap-3"><i class="fas fa-building w-5"></i> 기업 정보</div>
            </nav>
        </aside>

        <main class="flex-1 overflow-y-auto bg-slate-50 p-8 relative">
            
            <section id="tab-dashboard" class="space-y-6">
                <header class="flex justify-between items-end">
                    <div><h2 class="text-2xl font-bold text-slate-900">통합 관제 대시보드</h2><p class="text-sm text-slate-500">Environmental Impact Monitoring</p></div>
                    <button onclick="switchTab('lca')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-indigo-700">새 평가 시작</button>
                </header>
                
                <div class="grid grid-cols-4 gap-4">
                    <div class="kpi-card"><div class="text-xs text-slate-500 font-bold mb-1">TOTAL GWP</div><div class="text-2xl font-bold"><span id="dash-total">0.00</span> <span class="text-sm text-slate-400">kgCO2e</span></div></div>
                    <div class="kpi-card"><div class="text-xs text-slate-500 font-bold mb-1">GRADE</div><div class="text-xl font-bold text-green-600">A+ (Low)</div></div>
                    <div class="kpi-card"><div class="text-xs text-slate-500 font-bold mb-1">SAVING</div><div class="text-xl font-bold text-blue-600">₩ 15.2M</div></div>
                    <div class="kpi-card"><div class="text-xs text-slate-500 font-bold mb-1">COMPLIANCE</div><div class="text-xl font-bold text-indigo-600">Pass</div></div>
                </div>

                <div class="grid grid-cols-3 gap-6">
                    <div class="col-span-2 bg-white p-6 rounded-2xl border shadow-sm h-80">
                        <h4 class="font-bold text-slate-800 mb-4 text-sm">월별 배출량 추이 (Trend)</h4>
                        <canvas id="lineChart"></canvas>
                    </div>
                    <div class="col-span-1 bg-white p-6 rounded-2xl border shadow-sm h-80">
                        <h4 class="font-bold text-slate-800 mb-4 text-sm">핫스팟 분석 (Hotspot)</h4>
                        <canvas id="donutChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="tab-lca" class="hidden grid grid-cols-12 gap-8">
                <div class="col-span-8 space-y-6 pb-20">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-slate-900">정밀 LCA 평가</h2>
                        <button onclick="openAI()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-indigo-700 shadow-md">
                            <i class="fas fa-magic"></i> AI 데이터 자동 입력
                        </button>
                    </div>

                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-800 mb-4 border-l-4 border-indigo-500 pl-3">1. 제품 및 범위 (Scope)</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block text-xs font-bold text-slate-500 mb-1">제품 카테고리</label>
                                <select id="inp-cat" class="input-field bg-slate-50" onchange="applyDefaults()">
                                    <option value="tshirt">T-Shirts (Knitted)</option>
                                    <option value="pants">Pants (Woven)</option>
                                    <option value="jacket">Jacket (Outer)</option>
                                </select>
                            </div>
                            <div><label class="block text-xs font-bold text-slate-500 mb-1">생산 국가 (Grid)</label>
                                <select id="inp-grid" class="input-field" onchange="calculateAll()">
                                    <option value="0.478">Korea (0.478)</option>
                                    <option value="0.584">China (0.584)</option>
                                    <option value="0.450">Vietnam (0.450)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-800 mb-4 border-l-4 border-indigo-500 pl-3">2. 자재 명세 (Materials)</h3>
                        <table class="w-full text-sm text-left">
                            <thead><tr class="text-xs text-slate-400 border-b"><th class="py-2">자재명</th><th>공정</th><th class="text-right">중량(kg)</th></tr></thead>
                            <tbody id="bom-list">
                                </tbody>
                        </table>
                        <button onclick="addBom()" class="mt-3 text-xs bg-slate-100 text-slate-600 px-3 py-1.5 rounded hover:bg-slate-200 font-bold">+ 행 추가</button>
                    </div>

                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-800 mb-4 border-l-4 border-indigo-500 pl-3">3. 제조 공정 (Production)</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <div><label class="text-xs font-bold text-slate-500 block mb-1">전력 (kWh)</label><input type="number" id="inp-elec" class="input-field" value="0" oninput="calculateAll()"></div>
                            <div><label class="text-xs font-bold text-slate-500 block mb-1">가스 (MJ)</label><input type="number" id="inp-gas" class="input-field" value="0" oninput="calculateAll()"></div>
                            <div><label class="text-xs font-bold text-slate-500 block mb-1">용수 (ton)</label><input type="number" id="inp-water" class="input-field" value="0" oninput="calculateAll()"></div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-800 mb-4 border-l-4 border-indigo-500 pl-3">4. 물류 및 유통 (Logistics)</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-xs font-bold text-slate-500 block mb-1">포장재 중량 (kg)</label><input type="number" id="inp-pack" class="input-field" value="0.05" oninput="calculateAll()"></div>
                            <div><label class="text-xs font-bold text-slate-500 block mb-1">운송 거리 (km)</label><input type="number" id="inp-dist" class="input-field" value="10000" oninput="calculateAll()"></div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-800 mb-4 border-l-4 border-indigo-500 pl-3">5. 사용 및 폐기 (Use & EOL)</h3>
                        <div class="grid grid-cols-4 gap-4">
                            <div><label class="text-xs font-bold text-indigo-600 block mb-1">수명(세탁횟수)</label><input type="number" id="inp-wash" class="input-field bg-indigo-50 font-bold" readonly></div>
                            <div><label class="text-xs font-bold text-indigo-600 block mb-1">세탁온도(℃)</label><input type="number" id="inp-temp" class="input-field bg-indigo-50 font-bold" readonly></div>
                            <div><label class="text-xs font-bold text-indigo-600 block mb-1">다림질(hr)</label><input type="number" id="inp-iron" class="input-field bg-indigo-50 font-bold" readonly></div>
                            <div><label class="text-xs font-bold text-slate-500 block mb-1">폐기방식</label>
                                <select id="inp-eol" class="input-field" onchange="calculateAll()">
                                    <option value="0.5">소각 (Incineration)</option>
                                    <option value="0.1">매립 (Landfill)</option>
                                    <option value="-0.2">재활용 (Recycle)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-span-4">
                    <div class="bg-slate-900 text-white rounded-2xl p-6 shadow-2xl sticky top-6">
                        <h4 class="text-xs font-bold text-slate-400 tracking-widest mb-4">REAL-TIME IMPACT</h4>
                        <div class="text-4xl font-black mb-6"><span id="res-total">0.00</span> <span class="text-base font-normal text-slate-400">kgCO2e</span></div>
                        <div class="space-y-3 text-sm border-t border-slate-700 pt-4">
                            <div class="flex justify-between"><span>1. Material</span><span id="res-mat">0.00</span></div>
                            <div class="flex justify-between"><span>2. Production</span><span id="res-mfg">0.00</span></div>
                            <div class="flex justify-between"><span>3. Logistics</span><span id="res-dist">0.00</span></div>
                            <div class="flex justify-between"><span>4. Use Phase</span><span id="res-use">0.00</span></div>
                            <div class="flex justify-between"><span>5. End-of-Life</span><span id="res-eol">0.00</span></div>
                        </div>
                        <button onclick="saveData()" class="w-full bg-indigo-600 hover:bg-indigo-500 mt-8 py-3 rounded-xl font-bold shadow-lg transition-transform active:scale-95">결과 저장 및 대시보드 반영</button>
                    </div>
                </div>
            </section>

            <section id="tab-report" class="hidden">
                <header class="flex justify-between items-end mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">ISO 14067 검증 리포트</h2>
                    <button onclick="window.print()" class="bg-white border px-4 py-2 rounded shadow text-sm font-bold">PDF 인쇄</button>
                </header>
                <div class="report-paper p-12">
                    <div class="border-b-2 border-black pb-6 mb-8 text-center">
                        <h1 class="text-3xl font-serif font-bold">Product Carbon Footprint Report</h1>
                        <p class="text-slate-500 mt-2">Compliance with ISO 14067 & GHG Protocol</p>
                    </div>
                    <div id="report-body" class="text-sm space-y-6">
                        </div>
                </div>
            </section>

            <section id="tab-corporate" class="hidden">
                <h2 class="text-2xl font-bold text-slate-800 mb-6">기업 정보 관리</h2>
                <div class="bg-white p-8 rounded-xl border shadow-sm max-w-4xl">
                    <div class="flex gap-2 mb-6">
                        <input id="corp-no" type="text" class="input-field w-64 text-left" placeholder="사업자번호 (10자리)">
                        <button onclick="searchCorp()" class="bg-slate-800 text-white px-4 rounded font-bold hover:bg-slate-700">조회</button>
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="text-xs font-bold text-slate-500">법인명 (API)</label><input id="c-name" class="input-field bg-slate-50" readonly placeholder="-"></div>
                        <div><label class="text-xs font-bold text-slate-500">대표자 (API)</label><input id="c-ceo" class="input-field bg-slate-50" readonly placeholder="-"></div>
                        <div><label class="text-xs font-bold text-indigo-600">담당자 (직접입력)</label><input class="input-field border-indigo-300" placeholder="입력"></div>
                        <div><label class="text-xs font-bold text-indigo-600">연락처 (직접입력)</label><input class="input-field border-indigo-300" placeholder="입력"></div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <div id="ai-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="bg-white w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden animate-fade-in-up">
            <div class="bg-slate-900 text-white px-6 py-4 flex justify-between items-center">
                <h3 class="font-bold flex items-center gap-2"><i class="fas fa-robot"></i> AI Smart Data Collector</h3>
                <button onclick="closeAI()" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-8 grid grid-cols-3 gap-6 bg-slate-50">
                <div class="border-2 border-dashed border-indigo-300 bg-white p-6 rounded-xl text-center cursor-pointer hover:bg-indigo-50 transition" onclick="runAI('bom')">
                    <i class="fas fa-layer-group text-3xl text-indigo-500 mb-2"></i>
                    <h4 class="font-bold text-sm">Scope 3 (자재)</h4>
                    <p class="text-xs text-slate-400">BOM Excel/PDF</p>
                </div>
                <div class="border-2 border-dashed border-yellow-300 bg-white p-6 rounded-xl text-center cursor-pointer hover:bg-yellow-50 transition" onclick="runAI('energy')">
                    <i class="fas fa-bolt text-3xl text-yellow-500 mb-2"></i>
                    <h4 class="font-bold text-sm">Scope 1&2 (에너지)</h4>
                    <p class="text-xs text-slate-400">Bill Image/PDF</p>
                </div>
                <div class="border-2 border-dashed border-green-300 bg-white p-6 rounded-xl text-center cursor-pointer hover:bg-green-50 transition" onclick="runAI('logis')">
                    <i class="fas fa-truck text-3xl text-green-500 mb-2"></i>
                    <h4 class="font-bold text-sm">Scope 3 (물류/폐기)</h4>
                    <p class="text-xs text-slate-400">Invoice PDF</p>
                </div>
                <div class="col-span-3 bg-slate-900 rounded-lg p-4 h-32 overflow-y-auto font-mono text-xs text-green-400" id="ai-log">
                    > System Ready.<br>> Waiting for files...
                </div>
            </div>
            <div class="px-6 py-4 border-t bg-white flex justify-end gap-3">
                <button onclick="closeAI()" class="px-4 py-2 text-slate-500 font-bold hover:bg-slate-100 rounded">취소</button>
                <button onclick="applyAIData()" class="px-6 py-2 bg-indigo-600 text-white font-bold rounded shadow hover:bg-indigo-700">데이터 적용하기</button>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        const STATE = {
            history: [
                {date:'2025-09-10', gwp:14.2}, {date:'2025-10-15', gwp:12.5}, 
                {date:'2025-11-20', gwp:11.8}, {date:'2025-12-05', gwp:9.4}
            ],
            current: { mat:0, mfg:0, dist:0, use:0, eol:0, total:0 }
        };

        // --- 1. INIT & DEFAULTS ---
        function init() {
            addBom(); // Add one default row
            applyDefaults(); // Set default values based on T-shirt
            renderCharts(); // Draw initial charts
            calculateAll(); // Run first calc
        }

        function applyDefaults() {
            const cat = document.getElementById('inp-cat').value;
            // OFFICIAL DEFAULTS (PEFCR)
            const defaults = {
                'tshirt': { wash: 52, temp: 40, iron: 0.5 },
                'pants': { wash: 100, temp: 30, iron: 0.2 },
                'jacket': { wash: 20, temp: 30, iron: 0 }
            };
            const d = defaults[cat];
            document.getElementById('inp-wash').value = d.wash;
            document.getElementById('inp-temp').value = d.temp;
            document.getElementById('inp-iron').value = d.iron;
            calculateAll();
        }

        // --- 2. MASTER CALCULATION LOGIC (The Brain) ---
        function calculateAll() {
            // 1. Material (Scope 3)
            let sumMat = 0;
            document.querySelectorAll('.bom-weight').forEach(input => {
                const weight = parseFloat(input.value) || 0;
                sumMat += weight * 2.5; // Avg EF for Cotton
            });

            // 2. Production (Scope 1&2)
            const elec = parseFloat(document.getElementById('inp-elec').value) || 0;
            const gas = parseFloat(document.getElementById('inp-gas').value) || 0;
            const water = parseFloat(document.getElementById('inp-water').value) || 0;
            const grid = parseFloat(document.getElementById('inp-grid').value);
            const sumMfg = (elec * grid) + (gas * 0.202) + (water * 0.3);

            // 3. Distribution (Scope 3)
            const pack = parseFloat(document.getElementById('inp-pack').value) || 0;
            const dist = parseFloat(document.getElementById('inp-dist').value) || 0;
            const sumDist = (pack * 1.5) + (dist * 0.0001 * 0.5); // t-km logic

            // 4. Use Phase (Scope 3 - Standard Formula)
            const wash = parseFloat(document.getElementById('inp-wash').value) || 0;
            const temp = parseFloat(document.getElementById('inp-temp').value) || 0;
            const iron = parseFloat(document.getElementById('inp-iron').value) || 0;
            // E = cycles * (0.2 + (temp-20)*0.01) * grid
            const energyPerWash = 0.2 + ((temp - 20) * 0.01);
            const sumUse = (wash * energyPerWash * grid) + (iron * wash * 0.5 * grid);

            // 5. EOL (Scope 3)
            const eolFactor = parseFloat(document.getElementById('inp-eol').value);
            const totalWeight = 0.25; // Approx weight of product
            const sumEol = totalWeight * eolFactor;

            // Total
            const total = sumMat + sumMfg + sumDist + sumUse + sumEol;

            // UPDATE UI
            document.getElementById('res-mat').innerText = sumMat.toFixed(2);
            document.getElementById('res-mfg').innerText = sumMfg.toFixed(2);
            document.getElementById('res-dist').innerText = sumDist.toFixed(2);
            document.getElementById('res-use').innerText = sumUse.toFixed(2);
            document.getElementById('res-eol').innerText = sumEol.toFixed(2);
            document.getElementById('res-total').innerText = total.toFixed(2);
            document.getElementById('live-total').innerText = total.toFixed(2);

            // Save to State
            STATE.current = { mat: sumMat, mfg: sumMfg, dist: sumDist, use: sumUse, eol: sumEol, total: total };

            // Real-time Chart Update
            if (window.donutChart) {
                window.donutChart.data.datasets[0].data = [sumMat, sumMfg, sumDist, sumUse, sumEol];
                window.donutChart.update();
            }
            
            // Real-time Report Update
            updateReportHTML();
        }

        // --- 3. UI HELPERS ---
        function switchTab(id) {
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('nav-active'));
            document.getElementById('btn-' + id).classList.add('nav-active');

            // [FIXED] Force Chart Update on Tab Switch
            if (id === 'dashboard') {
                setTimeout(() => {
                    calculateAll();
                    updateCharts();
                }, 100);
            }
        }

        function addBom() {
            const row = `<tr>
                <td class="p-2"><select class="input-field"><option>Cotton Fabric</option><option>Polyester</option></select></td>
                <td class="p-2"><select class="input-field"><option>Spinning</option><option>Weaving</option></select></td>
                <td class="p-2"><input type="number" class="input-field bom-weight" value="0.2" oninput="calculateAll()"></td>
            </tr>`;
            document.getElementById('bom-list').insertAdjacentHTML('beforeend', row);
            calculateAll();
        }

        function saveData() {
            const today = new Date().toISOString().split('T')[0];
            STATE.history.push({ date: today, gwp: STATE.current.total });
            
            // Calc Avg
            const sum = STATE.history.reduce((a, b) => a + b.gwp, 0);
            document.getElementById('dash-avg-gwp').innerText = (sum / STATE.history.length).toFixed(2);

            alert("데이터가 저장되고 대시보드에 반영되었습니다.");
            switchTab('dashboard');
        }

        function updateReportHTML() {
            const html = `
                <table class="w-full border-collapse border border-slate-300 text-sm">
                    <tr class="bg-slate-100"><th class="border p-2">Stage</th><th class="border p-2">Impact (kgCO2e)</th></tr>
                    <tr><td class="border p-2">Materials</td><td class="border p-2 text-right">${STATE.current.mat.toFixed(2)}</td></tr>
                    <tr><td class="border p-2">Manufacturing</td><td class="border p-2 text-right">${STATE.current.mfg.toFixed(2)}</td></tr>
                    <tr><td class="border p-2">Distribution</td><td class="border p-2 text-right">${STATE.current.dist.toFixed(2)}</td></tr>
                    <tr><td class="border p-2">Use Phase</td><td class="border p-2 text-right">${STATE.current.use.toFixed(2)}</td></tr>
                    <tr><td class="border p-2">End of Life</td><td class="border p-2 text-right">${STATE.current.eol.toFixed(2)}</td></tr>
                    <tr class="bg-slate-200 font-bold"><td class="border p-2">TOTAL</td><td class="border p-2 text-right">${STATE.current.total.toFixed(2)}</td></tr>
                </table>
            `;
            document.getElementById('report-body').innerHTML = html;
        }

        function searchCorp() {
            // Mock API
            setTimeout(() => {
                document.getElementById('c-name').value = '(주)한국지속가능성연구원';
                document.getElementById('c-ceo').value = '김주현';
                alert('공공데이터 포털 조회 성공');
            }, 500);
        }

        // --- 4. AI MODAL ---
        function openAI() { document.getElementById('ai-modal').classList.remove('hidden'); }
        function closeAI() { document.getElementById('ai-modal').classList.add('hidden'); }
        
        function runAI(type) {
            const log = document.getElementById('ai-log');
            log.innerHTML += `<br>> Scanning ${type.toUpperCase()} file... OK.`;
            log.scrollTop = log.scrollHeight;
        }

        function applyAIData() {
            // Force Injection Logic
            document.getElementById('inp-elec').value = 2.5; // Energy
            document.getElementById('inp-gas').value = 0.8;
            document.getElementById('inp-water').value = 1.2;
            
            // BOM Reset & Inject
            document.getElementById('bom-list').innerHTML = `
            <tr>
                <td class="p-2"><select class="input-field"><option>Cotton Fabric</option></select></td>
                <td class="p-2"><select class="input-field"><option>Spinning</option></select></td>
                <td class="p-2"><input type="number" class="input-field bom-weight" value="0.3" oninput="calculateAll()"></td>
            </tr>`;

            calculateAll(); // Trigger Everything
            closeAI();
            alert('AI 데이터가 3개 분류(Scope 1,2,3) 기준에 맞춰 매핑되었습니다.');
        }

        // --- 5. CHARTS ---
        function renderCharts() {
            // Line Chart
            window.lineChart = new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: {
                    labels: STATE.history.map(h => h.date),
                    datasets: [{
                        label: 'GWP Trend',
                        data: STATE.history.map(h => h.gwp),
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Donut Chart
            window.donutChart = new Chart(document.getElementById('donutChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Mat', 'Mfg', 'Dist', 'Use', 'EOL'],
                    datasets: [{
                        data: [1, 1, 1, 1, 1], // Initial dummy
                        backgroundColor: ['#94a3b8', '#fbbf24', '#34d399', '#60a5fa', '#f87171']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%' }
            });
        }

        function updateCharts() {
            if(window.lineChart) {
                window.lineChart.data.labels = STATE.history.map(h => h.date);
                window.lineChart.data.datasets[0].data = STATE.history.map(h => h.gwp);
                window.lineChart.update();
            }
            if(window.donutChart) {
                window.donutChart.data.datasets[0].data = [STATE.current.mat, STATE.current.mfg, STATE.current.dist, STATE.current.use, STATE.current.eol];
                window.donutChart.update();
            }
        }

        // START
        init();
    </script>
</body>
</html>
