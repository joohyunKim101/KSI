<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSIKR - Final Enterprise Platform (v2000)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f3f4f6; color: #1f2937; }

        /* Navigation */
        .nav-item { padding: 12px 16px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; align-items: center; transition: all 0.2s; color: #6b7280; margin-bottom: 4px; }
        .nav-item:hover { background: #e5e7eb; color: #111827; }
        .nav-item.active { background: #e0e7ff; color: #4338ca; font-weight: 700; border-right: 4px solid #4338ca; }

        /* Stepper (The Core of Detailed LCA) */
        .stepper-item { flex: 1; text-align: center; position: relative; cursor: pointer; opacity: 0.6; transition: 0.3s; }
        .stepper-item.active { opacity: 1; font-weight: bold; color: #4f46e5; }
        .stepper-circle { width: 32px; height: 32px; border-radius: 50%; background: white; border: 2px solid #d1d5db; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; z-index: 10; position: relative; }
        .stepper-item.active .stepper-circle { border-color: #4f46e5; background: #4f46e5; color: white; }
        .stepper-line { position: absolute; top: 16px; left: 0; width: 100%; height: 2px; background: #e5e7eb; z-index: 0; }

        /* Cards & Map */
        .card { background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        #map-container { height: 100%; width: 100%; min-height: 400px; border-radius: 8px; z-index: 1; }
        
        /* Animation */
        .scanner-line { position: absolute; width: 100%; height: 2px; background: #3b82f6; top: 0; animation: scan 1.5s infinite; display: none; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
        .scanning .scanner-line { display: block; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shrink-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">K</div>
            <div>
                <h1 class="font-bold text-base text-slate-900">KSIKR <span class="text-indigo-600">Enterprise</span></h1>
                <p class="text-[11px] text-slate-500">v2000.0 | ISO 14067 Standard</p>
            </div>
        </div>
        <div class="flex items-center gap-4 text-xs">
            <div class="px-3 py-1 bg-green-50 text-green-700 rounded border border-green-200 font-bold"><i class="fas fa-check-circle mr-1"></i> System Ready</div>
            <div class="px-3 py-1 bg-slate-100 rounded border border-slate-200 font-bold text-slate-600">User: CEO Kim</div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-64 bg-white border-r border-slate-200 flex flex-col p-4 z-40 overflow-y-auto">
            <nav class="flex-1 space-y-1">
                <div class="text-[11px] font-bold text-slate-400 uppercase px-3 mb-2 mt-2 tracking-wider">Analysis</div>
                <div class="nav-item active" onclick="setTab('dash')" id="nav-dash"><i class="fas fa-chart-pie w-6"></i> Dashboard</div>
                <div class="nav-item" onclick="setTab('lca')" id="nav-lca"><i class="fas fa-calculator w-6"></i> 정밀 전과정평가 (LCA)</div>
                <div class="nav-item" onclick="setTab('studio')" id="nav-studio"><i class="fas fa-sliders-h w-6"></i> Smart Studio</div>
                
                <div class="text-[11px] font-bold text-slate-400 uppercase px-3 mb-2 mt-6 tracking-wider">Regulation</div>
                <div class="nav-item" onclick="setTab('report')" id="nav-report"><i class="fas fa-file-contract w-6"></i> Official Report</div>
                <div class="nav-item" onclick="setTab('dpp')" id="nav-dpp"><i class="fas fa-passport w-6"></i> Digital Passport</div>
                
                <div class="text-[11px] font-bold text-slate-400 uppercase px-3 mb-2 mt-6 tracking-wider">Management</div>
                <div class="nav-item" onclick="setTab('supply')" id="nav-supply"><i class="fas fa-network-wired w-6"></i> Supply Chain</div>
                <div class="nav-item" onclick="setTab('history')" id="nav-history"><i class="fas fa-history w-6"></i> History</div>
                <div class="nav-item" onclick="setTab('company')" id="nav-company"><i class="fas fa-building w-6"></i> Company Info</div>
            </nav>
        </aside>

        <main class="flex-1 overflow-y-auto bg-slate-50 p-8 relative">

            <section id="tab-dash" class="space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-slate-900">Executive Dashboard</h2>
                    <span class="text-xs bg-white border px-3 py-1 rounded text-slate-500">Last Sync: Just now</span>
                </div>

                <div class="grid grid-cols-4 gap-6">
                    <div class="card p-5 border-l-4 border-indigo-500">
                        <div class="text-xs text-slate-500 font-bold uppercase">Total Emissions</div>
                        <div class="text-3xl font-bold text-slate-900 mt-2">15.5 <span class="text-sm font-normal text-slate-500">kgCO2e</span></div>
                    </div>
                    <div class="card p-5 border-l-4 border-green-500">
                        <div class="text-xs text-slate-500 font-bold uppercase">Eco-Grade</div>
                        <div class="text-3xl font-bold text-green-600 mt-2">B+</div>
                    </div>
                    <div class="card p-5 border-l-4 border-red-500">
                        <div class="text-xs text-slate-500 font-bold uppercase">Hotspot</div>
                        <div class="text-xl font-bold text-red-600 mt-2">Upstream (65%)</div>
                    </div>
                    <div class="card p-5 border-l-4 border-orange-500">
                        <div class="text-xs text-slate-500 font-bold uppercase">Regulations</div>
                        <div class="text-xl font-bold text-slate-900 mt-2">2 <span class="text-sm font-normal text-slate-500">Active</span></div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6 h-[450px]">
                    <div class="card flex flex-col">
                        <h3 class="text-sm font-bold text-slate-800 mb-4">Emissions Breakdown</h3>
                        <div class="flex-1 relative"><canvas id="dashChart"></canvas></div>
                    </div>
                    <div class="card p-0 flex flex-col relative overflow-hidden">
                        <div class="absolute top-4 left-4 z-[999] bg-white/90 px-3 py-1.5 rounded shadow text-xs font-bold text-slate-700">
                            Live Supply Chain
                        </div>
                        <div id="map-container"></div>
                    </div>
                </div>
            </section>

            <section id="tab-lca" class="hidden max-w-7xl mx-auto space-y-8">
                
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-900">정밀 전과정평가 (Detailed LCA)</h2>
                        <p class="text-xs text-slate-500 mt-1">ISO 14067 Standard Methodology (Cradle-to-Grave)</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="calculate()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg text-sm font-bold shadow hover:bg-indigo-700 transition">
                            <i class="fas fa-calculator mr-2"></i>Calculate & Verify
                        </button>
                    </div>
                </div>

                <div class="relative flex justify-between px-8 mb-8">
                    <div class="absolute top-4 left-0 w-full h-0.5 bg-slate-200 z-0"></div>
                    <div class="stepper-item active" onclick="setLcaStage(1)">
                        <div class="stepper-circle">1</div>
                        <span class="text-xs">Raw Material</span>
                    </div>
                    <div class="stepper-item" onclick="setLcaStage(2)">
                        <div class="stepper-circle">2</div>
                        <span class="text-xs">Manufacturing</span>
                    </div>
                    <div class="stepper-item" onclick="setLcaStage(3)">
                        <div class="stepper-circle">3</div>
                        <span class="text-xs">Distribution</span>
                    </div>
                    <div class="stepper-item" onclick="setLcaStage(4)">
                        <div class="stepper-circle">4</div>
                        <span class="text-xs">Use Phase</span>
                    </div>
                    <div class="stepper-item" onclick="setLcaStage(5)">
                        <div class="stepper-circle">5</div>
                        <span class="text-xs">End of Life</span>
                    </div>
                </div>

                <div class="grid grid-cols-12 gap-8">
                    <div class="col-span-8 space-y-6">
                        <div class="card relative">
                            <div class="flex justify-between mb-4">
                                <h3 class="text-sm font-bold text-indigo-700" id="lca-stage-title">1. Raw Material Acquisition</h3>
                                <div id="btn-ocr" class="cursor-pointer text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded font-bold border border-blue-200">
                                    <i class="fas fa-camera mr-1"></i> AI OCR Scan
                                    <div class="scanner-line" id="ocr-scan-line"></div>
                                </div>
                            </div>
                            
                            <table class="w-full text-sm text-left">
                                <thead class="bg-slate-50 text-xs uppercase text-slate-500 font-bold">
                                    <tr><th class="p-3">Item</th><th class="p-3">Origin</th><th class="p-3 text-right">Value (kg/km)</th><th class="p-3 text-right">Impact</th><th class="p-3 text-center">Action</th></tr>
                                </thead>
                                <tbody id="lca-input-body" class="divide-y divide-slate-100">
                                    </tbody>
                            </table>
                            
                            <div class="mt-4 pt-4 border-t border-slate-100 flex gap-2">
                                <input type="text" placeholder="Item Name" class="border rounded px-2 py-1 text-xs w-1/3">
                                <input type="number" placeholder="Value" class="border rounded px-2 py-1 text-xs w-20">
                                <button class="bg-slate-800 text-white px-3 py-1 rounded text-xs font-bold">+ Add Row</button>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-4 space-y-4">
                        <div class="card bg-slate-900 text-white">
                            <h4 class="text-xs text-slate-400 uppercase font-bold mb-2">Total GWP (Projected)</h4>
                            <div class="flex items-end gap-2 mb-4">
                                <span class="text-4xl font-bold" id="res-total">0.00</span>
                                <span class="text-sm text-slate-400 mb-1">kgCO₂e</span>
                            </div>
                            <div class="space-y-2 text-sm border-t border-slate-700 pt-3">
                                <div class="flex justify-between"><span>Upstream</span><span id="res-up">0.00</span></div>
                                <div class="flex justify-between"><span>Downstream</span><span id="res-down">0.00</span></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h4 class="text-xs text-slate-500 uppercase font-bold mb-3">Regulation Check</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between items-center"><span>EU CBAM</span><span class="text-green-600 font-bold"><i class="fas fa-check"></i> OK</span></div>
                                <div class="flex justify-between items-center"><span>ESPR</span><span class="text-orange-500 font-bold"><i class="fas fa-exclamation-circle"></i> Review</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="tab-studio" class="hidden max-w-7xl mx-auto">
                <div class="card p-20 text-center text-slate-400">
                    <h2 class="text-xl font-bold text-slate-600 mb-2">Smart Simulation Studio</h2>
                    <p>Comparison & Optimization Module (Same as v1800)</p>
                </div>
            </section>

            <section id="tab-report" class="hidden max-w-4xl mx-auto">
                <div class="bg-white shadow-xl border p-12 min-h-[800px]">
                    <h1 class="text-3xl font-bold border-b-2 border-black pb-4 mb-8">Verification Report</h1>
                    <div class="bg-slate-50 p-8 text-center rounded border mb-8">
                        <div class="text-4xl font-bold text-slate-900"><span id="rpt-val">0.00</span> kgCO2e</div>
                        <p class="text-xs text-slate-500 mt-2">System Boundary: Cradle-to-Grave</p>
                    </div>
                    <table class="w-full text-sm border-collapse">
                        <tr class="bg-slate-100 border-y border-slate-300"><th class="text-left p-2">Stage</th><th class="text-right p-2">Impact</th></tr>
                        <tr class="border-b"><td class="p-2">Upstream</td><td class="text-right p-2" id="rpt-up">0.00</td></tr>
                        <tr class="border-b"><td class="p-2">Downstream</td><td class="text-right p-2" id="rpt-down">0.00</td></tr>
                    </table>
                </div>
            </section>

            <section id="tab-dpp" class="hidden">
                <div class="card max-w-sm mx-auto bg-slate-800 text-white p-8 rounded-3xl">
                    <h3 class="text-center font-bold text-xl mb-4">Digital Product Passport</h3>
                    <div class="bg-white p-4 rounded-xl mb-4"><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=KSIKR-LCA-DATA" class="mx-auto"></div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between border-b border-slate-600 pb-2"><span>Carbon</span><span class="font-bold text-green-400" id="dpp-val">0.00 kg</span></div>
                        <div class="flex justify-between border-b border-slate-600 pb-2"><span>Origin</span><span>Vietnam</span></div>
                    </div>
                </div>
            </section>

            <section id="tab-supply" class="hidden"><div class="card p-20 text-center">Supply Chain Table Loaded</div></section>
            <section id="tab-history" class="hidden"><div class="card p-20 text-center">History Log Loaded</div></section>
            <section id="tab-company" class="hidden"><div class="card p-20 text-center">Company Info Loaded</div></section>

        </main>
    </div>

    <script>
        // --- DATA & STATE ---
        let CURRENT_STAGE = 1;
        let CHART_INSTANCE = null;
        let MAP_INSTANCE = null;
        
        // 5-Stage Data Structure
        const LCA_DATA = {
            1: [{ name: 'Poly Fabric', loc: 'CN', val: 0.3, impact: 0.45 }],
            2: [{ name: 'Dyeing', loc: 'VN', val: 1.0, impact: 0.60 }],
            3: [{ name: 'Logistics', loc: 'Global', val: 8000, impact: 0.50 }],
            4: [{ name: 'Washing', loc: 'EU', val: 50, impact: 0.30 }],
            5: [{ name: 'Incineration', loc: 'EU', val: 0.3, impact: 0.20 }]
        };

        // --- LOGIC ---
        function calculate() {
            let up = 0, down = 0;
            
            // Sum Upstream (1-2)
            [1, 2].forEach(s => LCA_DATA[s].forEach(i => up += i.impact));
            // Sum Downstream (3-5)
            [3, 4, 5].forEach(s => LCA_DATA[s].forEach(i => down += i.impact));
            
            const total = up + down;

            // UI Update
            updateText('res-total', total.toFixed(2));
            updateText('res-up', up.toFixed(2));
            updateText('res-down', down.toFixed(2));
            
            // Sync to other tabs
            updateText('dash-total', total.toFixed(2));
            updateText('rpt-val', total.toFixed(2));
            updateText('rpt-up', up.toFixed(2));
            updateText('rpt-down', down.toFixed(2));
            updateText('dpp-val', total.toFixed(2) + " kg");

            // Render Table & Chart
            renderTable();
            updateChart([LCA_DATA[1][0].impact, LCA_DATA[2][0].impact, LCA_DATA[3][0].impact, LCA_DATA[4][0].impact]);
        }

        function updateText(id, val) { 
            const el = document.getElementById(id);
            if(el) el.innerText = val; 
        }

        function renderTable() {
            const tbody = document.getElementById('lca-input-body');
            tbody.innerHTML = '';
            LCA_DATA[CURRENT_STAGE].forEach((item, idx) => {
                tbody.innerHTML += `
                    <tr class="border-b border-slate-100 hover:bg-slate-50">
                        <td class="p-3 font-medium">${item.name}</td>
                        <td class="p-3 text-slate-500 text-xs">${item.loc}</td>
                        <td class="p-3 text-right font-mono text-xs">${item.val}</td>
                        <td class="p-3 text-right font-bold text-xs">${item.impact.toFixed(2)}</td>
                        <td class="p-3 text-center text-xs text-red-400 cursor-pointer"><i class="fas fa-trash"></i></td>
                    </tr>`;
            });
        }

        function setLcaStage(stage) {
            CURRENT_STAGE = stage;
            
            // Update Stepper Visual
            document.querySelectorAll('.stepper-item').forEach((el, idx) => {
                if((idx + 1) === stage) {
                    el.classList.add('active');
                    el.querySelector('.stepper-circle').style.borderColor = '#4f46e5';
                    el.querySelector('.stepper-circle').style.color = '#fff';
                    el.querySelector('.stepper-circle').style.backgroundColor = '#4f46e5';
                } else {
                    el.classList.remove('active');
                    el.querySelector('.stepper-circle').style.borderColor = '#d1d5db';
                    el.querySelector('.stepper-circle').style.color = '#1f2937';
                    el.querySelector('.stepper-circle').style.backgroundColor = '#fff';
                }
            });

            // Update Title
            const titles = {1:'Raw Material', 2:'Manufacturing', 3:'Distribution', 4:'Use Phase', 5:'End of Life'};
            document.getElementById('lca-stage-title').innerText = `${stage}. ${titles[stage]}`;
            
            renderTable();
        }

        // --- VISUALS ---
        function initChart() {
            const ctx = document.getElementById('dashChart').getContext('2d');
            CHART_INSTANCE = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Mat', 'Mfg', 'Dist', 'Use'],
                    datasets: [{ data: [1,1,1,1], backgroundColor: ['#4f46e5', '#3b82f6', '#f59e0b', '#10b981'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { position: 'right' } } }
            });
        }

        function updateChart(data) {
            if(CHART_INSTANCE) { CHART_INSTANCE.data.datasets[0].data = data; CHART_INSTANCE.update(); }
        }

        function initMap() {
            if(MAP_INSTANCE) return;
            MAP_INSTANCE = L.map('map-container').setView([20, 105], 3);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OSM' }).addTo(MAP_INSTANCE);
            L.circleMarker([37.56, 126.97], { color:'red', radius:6 }).addTo(MAP_INSTANCE).bindPopup('Seoul');
            L.circleMarker([21.02, 105.85], { color:'orange', radius:6 }).addTo(MAP_INSTANCE).bindPopup('Hanoi');
        }

        // --- TABS ---
        function setTab(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('nav-' + id).classList.add('active');
            
            if(id === 'dash' && MAP_INSTANCE) setTimeout(() => MAP_INSTANCE.invalidateSize(), 100);
        }

        // OCR
        document.getElementById('btn-ocr').addEventListener('click', () => {
            const btn = document.getElementById('btn-ocr');
            btn.classList.add('scanning');
            setTimeout(() => {
                btn.classList.remove('scanning');
                LCA_DATA[CURRENT_STAGE].push({ name: 'Scanned Item', loc: 'Auto', val: 1.5, impact: 0.8 });
                calculate();
                alert('Data added to Stage ' + CURRENT_STAGE);
            }, 1000);
        });

        // INIT
        window.onload = function() {
            initChart();
            setTimeout(initMap, 200);
            setLcaStage(1);
            calculate();
        };
    </script>
</body>
</html>
